<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF to Word ‚Äì Smart Converter</title>
<meta name="description" content="Convert PDFs to Word documents online. Browser-only for small files, iLovePDF API for large files.">

<style>
body { margin:0; font-family:Arial,sans-serif; background:#0f0f0f; color:#fff; text-align:center; }
.container { max-width:600px; margin:30px auto; padding:20px; }
.logo img { max-width:220px; margin-bottom:20px; }
h1 { font-size:30px; margin-bottom:10px; }
p { color:#d1d5db; font-size:16px; margin-bottom:20px; }
input[type=file] { display:block; margin:20px auto; }
button { width:100%; padding:14px; font-size:18px; background:#22c55e; color:#fff; border:none; border-radius:8px; cursor:pointer; }
button:disabled { opacity:.6; cursor:not-allowed; }
#status { margin-top:15px; font-weight:bold; }
#download { display:none; margin-top:18px; padding:12px; background:#16a34a; color:#fff; text-decoration:none; border-radius:8px; display:inline-block; }
.home-btn { display:inline-block; margin-top:30px; padding:12px 24px; border:2px solid #fff; color:#fff; text-decoration:none; border-radius:8px; font-weight:bold; }
.home-btn:hover { background:#22c55e; border-color:#22c55e; }
.ad-placeholder { border:2px dashed #555; padding:20px; margin:25px 0; color:#aaa; font-size:14px; text-align:center; border-radius:6px; }
</style>
</head>

<body>
<div class="container">

  <!-- Logo -->
  <div class="logo">
    <a href="https://ibb.co.com/tMtwGGbr" target="_blank">
      <img src="https://i.ibb.co.com/XZgfQQzR/file-0000000024cc7206a8d22dc065915cc1.png" alt="PDF to Word Logo">
    </a>
  </div>

  <h1>PDF to Word</h1>
  <p>Select a PDF file. Files ‚â§12 MB will be converted in browser; larger files use iLovePDF API.</p>

  <div class="ad-placeholder">Ad Placeholder (Top)</div>

  <input type="file" id="fileInput" accept="application/pdf">
  <button id="convertBtn" disabled>Convert PDF to Word</button>

  <p id="status"></p>
  <a id="download">‚¨á Download Word</a>

  <div class="ad-placeholder">Ad Placeholder (Bottom)</div>

  <a class="home-btn" href="https://easyusehub.blogspot.com/p/free-pdf-tools-easyusehub.html?m=1">üè† Back to PDF Tools</a>

</div>

<!-- JS Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.umd.js"></script>

<script>
const { Document, Packer, Paragraph } = window.docx; // <-- UMD fix

const MAX_BROWSER_SIZE = 12 * 1024 * 1024; // 12 MB

const fileInput = document.getElementById("fileInput");
const convertBtn = document.getElementById("convertBtn");
const statusText = document.getElementById("status");
const downloadLink = document.getElementById("download");

let pdfFile = null;

fileInput.onchange = () => {
  pdfFile = fileInput.files[0];
  if(pdfFile){
    convertBtn.disabled = false;
    statusText.innerText = `Selected: ${pdfFile.name} (${(pdfFile.size/1024/1024).toFixed(2)} MB)`;
  } else {
    convertBtn.disabled = true;
    statusText.innerText = "";
  }
};

convertBtn.onclick = async () => {
  if(!pdfFile) return;

  if(pdfFile.size <= MAX_BROWSER_SIZE){
    // Browser-only conversion
    statusText.innerText = "‚è≥ Converting in browser...";
    try {
      const arrayBuffer = await pdfFile.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const doc = new Document();

      const pages = pdfDoc.getPages();
      for(const page of pages){
        const textContent = await page.getTextContent?.();
        const text = textContent?.items?.map(i=>i.str).join(" ") || "PDF page content";
        doc.addSection({ children: [ new Paragraph(text) ] });
      }

      const blob = await Packer.toBlob(doc);
      const url = URL.createObjectURL(blob);

      downloadLink.href = url;
      downloadLink.download = pdfFile.name.replace(".pdf","") + ".docx";
      downloadLink.style.display = "inline-block";
      statusText.innerText = "‚úÖ Word document ready (Browser)!";
    } catch(err){
      statusText.innerText = "‚ùå Browser conversion failed: " + err.message;
    }

  } else {
    // Large file ‚Üí API call
    statusText.innerText = "‚è≥ Uploading and converting via iLovePDF API...";
    try {
      const formData = new FormData();
      formData.append("file", pdfFile);

      const res = await fetch("/.netlify/functions/pdf2word", {
        method:"POST",
        body: formData
      });

      const data = await res.json();
      if(data.downloadUrl){
        downloadLink.href = data.downloadUrl;
        downloadLink.download = pdfFile.name.replace(".pdf","") + ".docx";
        downloadLink.style.display = "inline-block";
        statusText.innerText = "‚úÖ Word document ready (API)!";
      } else {
        statusText.innerText = "‚ùå API conversion failed";
      }
    } catch(err){
      statusText.innerText = "‚ùå Server/API error: " + err.message;
    }
  }
};
</script>

</body>
</html>
